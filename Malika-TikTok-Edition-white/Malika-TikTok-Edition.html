<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webdec Costum - Malika TikTok Paten V4</title>
    <link rel="icon" href="../../favicon.ico" />
    <link rel="preload" href="../../thirdparty/NotoColorEmoji.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <style>
/* ===============================
   THEME: MALIKA STUDIO REPLICA (V4)
   FIXED WIDTH + CENTERED CONTENT
================================ */
body { 
    background: transparent; 
    font-family: 'Inter', Arial, sans-serif; 
    margin: 0;
    overflow: hidden;
}

#container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 100vh;
    padding-left: 140px; 
}

/* BUBBLE CHAT - DINAMIS TAPI TETAP TERKONTROL */
.message {
    position: relative;
    display: flex; 
    flex-direction: column;
    /* Membuat teks di tengah secara vertikal agar tidak terlihat kosong */
    justify-content: center; 
    padding: 20px 25px; 
    background: rgba(255, 255, 255, 0.98); 
    backdrop-filter: blur(12px);
    border-radius: 0px 22px 22px 22px;
    
    /* LEBAR TETAP, TINGGI MINIMAL */
    width: 500px; 
    min-height: 110px;      /* Agar kotak punya bentuk paten walau chat pendek */
    max-height: 160px;      /* Batas maksimal untuk 3 baris teks */
    box-sizing: border-box;
    
    /* SHADOW PREMIUM */
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.2),   
        inset 0 0 10px rgba(255, 255, 255, 1); 
    
    margin-top: 20px;
}

/* EKOR CHAT */
.message::before {
    content: "";
    position: absolute;
    left: -18px; top: 15px;
    width: 0; height: 0;
    border-top: 12px solid transparent;
    border-bottom: 12px solid transparent;
    border-right: 18px solid rgba(255, 255, 255, 0.98);
}

/* AVATAR - POSISI TETAP DI SAMPING */
.avatar {
    position: absolute;
    left: -120px; 
    top: 5px; /* Bisa diubah ke '50% dan transform: translateY(-50%)' jika ingin avatar ikut ke tengah */
    width: 95px; 
    height: 95px;
    border-radius: 50%;
    border: 4px solid #ffffff;
    object-fit: cover;
    z-index: 10;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

/* USERNAME TIKTOK STYLE */
.username {
    position: absolute;
    top: -30px;
    left: 0px;
    display: flex !important;
    align-items: center;
    background: linear-gradient(90deg, #ff0050 0%, #00f2ea 100%);
    padding: 6px 20px;
    border-radius: 12px 12px 0 0;
    color: #ffffff !important;
    font-size: 16px;
    font-weight: 800;
    white-space: nowrap;
    z-index: 20;
    box-shadow: 0 -3px 10px rgba(0,0,0,0.15);
}

.username::before {
    content: "";
    display: inline-block;
    width: 20px; 
    height: 20px;
    background-color: #fff;
    background-image: url("tiktok.png"); 
    background-size: 80%;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 50%;
    margin-right: 8px;
}

/* TEKS PESAN - MAX 3 BARIS */
.text { 
    font-size: 24px; 
    font-weight: 600; 
    color: #111 !important; 
    line-height: 1.3;
    word-wrap: break-word;
    
    /* LIMIT 3 BARIS */
    display: -webkit-box;
    -webkit-line-clamp: 3; 
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ANIMASI MASUK */
.message-wrapper {
    opacity: 0;
    transform: translateX(-30px);
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.message-wrapper.show {
    opacity: 1;
    transform: translateX(0);
}

/* SEMBUNYIKAN ELEMEN LAIN */
.badges, .source-icon, .physics-bg, .particle, .donation-info { 
    display: none !important; 
}
    </style>
</head>
<body>
    <div id="container">
        <div id="output"></div>
    </div>

    <script src="../../tts.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomID = urlParams.get('session') || urlParams.get('room') || 'TESTROOM';
        const password = urlParams.get('password') || "false";

        function createIframe() {
            var iframe = document.createElement("iframe");
            iframe.src = "https://vdo.socialstream.ninja/?ln&password=" + password + "&notmobile&salt=vdo.ninja&label=overlay&exclude=" + roomID + "&scene&novideo&noaudio&cleanoutput&room=" + roomID;
            iframe.style.width = "0px"; iframe.style.height = "0px";
            iframe.style.position = "fixed"; iframe.style.left = "-100px";
            document.body.appendChild(iframe);

            window.addEventListener("message", function (e) {
                if (e.source != iframe.contentWindow) return;
                if (e.data.dataReceived && e.data.dataReceived.overlayNinja) {
                    let res = e.data.dataReceived.overlayNinja;
                    if (res.response) return;
                    processData({ contents: res });
                }
            });
        }

        function processData(data) {
            if (data && data.contents) showMessage(data.contents);
        }

        function showMessage(content) {
            if (!content.chatmessage && !content.chatname) return;

            const output = document.getElementById('output');
            output.innerHTML = ''; 

            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper';
            
            const message = document.createElement('div');
            message.className = 'message';

            // Avatar
            const avatar = document.createElement('img');
            avatar.className = 'avatar';
            avatar.src = content.chatimg || '../../sources/images/unknown.png';
            avatar.onerror = () => avatar.src = '../../sources/images/unknown.png';
            message.appendChild(avatar);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            // Username
            const name = document.createElement('span');
            name.className = 'username';
            name.textContent = content.chatname;
            contentDiv.appendChild(name);

            // Text
            const text = document.createElement('div');
            text.className = 'text';
            text.innerHTML = content.chatmessage;
            contentDiv.appendChild(text);

            message.appendChild(contentDiv);
            wrapper.appendChild(message);
            output.appendChild(wrapper);

            setTimeout(() => wrapper.classList.add('show'), 50);
        }

        createIframe();
    </script>
</body>
</html>
