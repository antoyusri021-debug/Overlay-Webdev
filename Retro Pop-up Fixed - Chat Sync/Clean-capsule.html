<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Pop-up Classic - Fixed Timer</title>
    <style>
        body {
            background: transparent !important;
            margin: 0;
            font-family: 'Segoe UI', 'Tahoma', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* KURSOR MOUSE ANIMASI */
        #auto-pointer {
            position: absolute;
            width: 24px;
            z-index: 9999;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            opacity: 0;
            filter: drop-shadow(2px 2px 1px rgba(0,0,0,0.2));
        }

        /* CARD STYLE RETRO CLASSIC */
        .notification-card {
            width: 350px;
            background: #c0c0c0; /* Abu-abu Windows Classic */
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            animation: popIn 0.2s ease-out;
            padding: 2px;
        }

        /* TITLE BAR BIRU KHAS WINDOWS */
        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            padding: 3px 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .title-text { color: white; font-size: 12px; font-weight: bold; font-family: sans-serif; }

        .close-btn {
            width: 16px; height: 14px; background: #c0c0c0;
            border: 1px solid; border-color: #ffffff #555 #555 #ffffff;
            font-size: 10px; font-weight: bold; text-align: center; line-height: 12px;
            cursor: default;
        }

        .content-body {
            padding: 15px;
            display: flex; gap: 12px; align-items: flex-start;
        }

        .user-avatar {
            width: 50px; height: 50px;
            border: 2px inset #ffffff;
            object-fit: cover;
        }

        .text-group { display: flex; flex-direction: column; gap: 4px; overflow: hidden; }
        .username { font-size: 14px; font-weight: bold; color: #000; }
        .message-text { 
            font-size: 13px; color: #000; 
            word-wrap: break-word; line-height: 1.4;
        }

        .button-footer {
            padding: 10px;
            display: flex; gap: 10px; justify-content: center;
        }

        /* BUTTON STYLE CLASSIC */
        .retro-button {
            min-width: 75px;
            padding: 4px 10px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #555 #555 #ffffff;
            font-size: 12px;
            text-align: center;
            color: #000;
        }

        .retro-button.clicked {
            border-color: #555 #ffffff #ffffff #555;
            background: #d0d0d0;
            padding-top: 5px; padding-bottom: 3px; /* Efek ditekan */
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hide-anim {
            animation: popOut 0.3s ease-in forwards;
        }

        @keyframes popOut {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0; }
        }
    </style>
</head>
<body>
    <img id="auto-pointer" src="kursor.png" onerror="this.src='https://cur.cursors-4u.net/arrow/arr-2/arr115.cur'">

    <div id="container"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomID = urlParams.get('session') || 'TESTROOM';
        const password = urlParams.get('password') || "false";
        const timerDur = parseInt(urlParams.get('timer')) || 10000; // Default 10 detik muncul

        const container = document.getElementById('container');
        const pointer = document.getElementById('auto-pointer');
        let hideTimeout = null;

        function createIframe() {
            const iframe = document.createElement("iframe");
            iframe.src = `https://vdo.socialstream.ninja/?ln&password=${password}&notmobile&salt=vdo.ninja&label=overlay&exclude=${roomID}&scene&novideo&noaudio&cleanoutput&room=${roomID}`;
            iframe.style.display = "none";
            document.body.appendChild(iframe);

            window.addEventListener("message", (e) => {
                if (e.source !== iframe.contentWindow) return;
                if (e.data.dataReceived && e.data.dataReceived.overlayNinja) {
                    const data = e.data.dataReceived.overlayNinja;
                    if (data.chatmessage) showRetroPopup(data);
                }
            });
        }

        function showRetroPopup(data) {
            if (hideTimeout) clearTimeout(hideTimeout);
            container.innerHTML = '';
            
            const card = document.createElement('div');
            card.className = 'notification-card';
            const userPhoto = data.chatimg || `https://api.dicebear.com/7.x/pixel-art/svg?seed=${data.chatname}`;

            card.innerHTML = `
                <div class="title-bar">
                    <span class="title-text">Message Received</span>
                    <div class="close-btn">r</div>
                </div>
                <div class="content-body">
                    <img src="${userPhoto}" class="user-avatar">
                    <div class="text-group">
                        <div class="username">${data.chatname}</div>
                        <div class="message-text">${data.chatmessage}</div>
                    </div>
                </div>
                <div class="button-footer">
                    <div class="retro-button" id="btn-ok">OK</div>
                    <div class="retro-button">Cancel</div>
                </div>
            `;
            container.appendChild(card);

            // Jalankan animasi kursor
            setTimeout(() => {
                const btn = document.getElementById('btn-ok');
                if(btn) {
                    const rect = btn.getBoundingClientRect();
                    
                    // Reset posisi kursor ke pojok bawah
                    pointer.style.opacity = "1";
                    pointer.style.left = "80%";
                    pointer.style.top = "80%";

                    // Gerak ke arah tombol OK
                    setTimeout(() => {
                        pointer.style.left = (rect.left + rect.width/2) + "px";
                        pointer.style.top = (rect.top + rect.height/2) + "px";
                    }, 200);

                    // Efek klik
                    setTimeout(() => { 
                        btn.classList.add('clicked'); 
                    }, 1000);

                    // Kursor hilang & Set timer untuk tutup pop-up
                    setTimeout(() => { 
                        pointer.style.opacity = "0"; 
                        // Start timer hide setelah di-klik
                        startHideTimer(card);
                    }, 1500);
                }
            }, 500);
        }

        function startHideTimer(element) {
            hideTimeout = setTimeout(() => {
                element.classList.add('hide-anim');
                setTimeout(() => { element.remove(); }, 300);
            }, timerDur);
        }

        createIframe();
    </script>
</body>
</html>
